{% extends "base.html" %}
{% load static %}
{% block meta %}
<title>SiBuk</title>
{% endblock meta %}

{% block content %}
<div class="d-flex flex-wrap gap-4 justify-content-center mt-4">
    <div class="card-box">
        <div class="card-box-inner shadow-sm">
          <div class="card-box-front d-flex gap-4">
            <img
            {% if food.category == "Kopi" %}
              src="{% static  'images/drinks/kopi.png' %}"
            {% else %}
              src="{% static  'images/drinks/nonkopi.png' %}"
            {% endif %}
              class="card-decoration"
              alt="card-decoration"
            />
            <div class="card-box-description">
              <h5 class="card-box-title mt-4" style="font-size: 1.25rem;">{{ drink.product }}</h5>
              <div>
                <p><strong>Merchant Area:</strong> {{ drink.merchant_area }}</p>
                <p><strong>Merchant Name:</strong> {{ drink.merchant_name }}</p>
                <p><strong>Product Description:</strong> {{ drink.description }}</p>
                <p><strong>Category:</strong> {{ drink.category }}</p>
                <button type="button" onclick="window.location.href = `{% url 'foods:show_drink' %}` " class="btn btn-outline-success">Back to Drink</button>
                <button id="reviewButton" data-content-type-id="food" data-object-id="{{ food.pk }}," class="btn btn-outline-warning">Review</button>

              </div>
            </div>
          </div>
        </div>
    </div>
   
</div>

<div class="modal fade" id="reviewModal" tabindex="-1" role="dialog" aria-labelledby="reviewModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      {% include 'review_modal.html' %}
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const reviewButton = document.getElementById("reviewButton");
  const reviewModal = $('#reviewModal');

  function showModal() {
    reviewModal.modal('show');
  }

  function hideModal() {
    reviewModal.modal('hide');
  }

  reviewButton.addEventListener("click", showModal);
  reviewModal.on('click', '.close', hideModal);
  reviewModal.on('click', '#close-modal', hideModal);

  reviewModal.on('submit', '#review-form', function(event) {
    event.preventDefault();
    const formData = $(this).serialize();
    $.ajax({
      type: 'POST',
      url: '{% url "reviews:review_fnd_ajax" content_type="food" object_id=drink.pk %}',
      data: formData,
      dataType: 'json',
      success: function(response) {
        if (response.login_required) {
            window.location.href = '{% url "user_auth:login" %}';
        } else if(response.success) {
            window.location.href = response.redirect_url;
        } else {
          console.error('Submission failed:', response.error);
        }
      },
      error: function(xhr, status, error) {
        console.error('Error:', xhr.responseText);
      }
    });
  });

});
</script>


{% endblock content %}

{% block script %}
<script src="/static/js/nav_script.js"></script>
<script src="/static/js/modal_Drink.js"></script>
{% endblock script %}
